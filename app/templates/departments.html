<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Compressed CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/foundation-sites@6.7.5/dist/css/foundation.min.css" crossorigin="anonymous">
    <!-- Compressed JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/foundation-sites@6.7.5/dist/js/foundation.min.js" crossorigin="anonymous"></script>
    <!-- Link to CSS -->
    <link rel="stylesheet" href="static/css/stylesheet.css">
    <title> Departments Data </title>
    <style>
        svg rect {
            fill: #00008B;
        }
        div.hover {
            /* stole someone else's css because I can't make things look good*/
            position: absolute;
            text-align: center;
            padding: .5rem;
            background: #FFFFFF;
            color: #313639;
            border: 1px solid #313639;
            border-radius: 8px;
            pointer-events: none;
            font-size: 12px;
        }
        .highlight {
            fill: blue;
        }
    .container {
      display: grid;
      grid-template-columns: 1fr 7fr 3fr;
      grid-gap: 20px;
    }
    .stats-selector {
        width: 100%;
        background-color: rgb(191,191,191);
        border: 1px solid black;
        border-radius: 10px;
        height: 11vh;
        color: black;
        padding: 0;
    }
    .stats-selector:focus {
        background-color: rgb(255,255,255);
        color: black;
    }
    .stats-selector:hover {
        background-color: rgb(220,220,220);
        color: black;
    }
    .selector-text {
        line-height: 1;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    </style>
</head>

<body>

    <!-- Navbar -->
    <nav class="top-bar" data-topbar role="navigation">
        <div class="top-bar-left">
            <ul class="dropdown menu" data-responsive-menu="drilldown medium-dropdown">
            <li class="menu-text">Professor-O-Meter</li>
            </ul>
        </div>
        <div class="top-bar-right">
            <ul class="dropdown menu" data-responsive-menu="drilldown medium-dropdown">
            <li><a href="/">Home</a></li>
            <li><a href="/professor">Professors</a></li>
            <li><a href="/lecture">Lectures</a></li>
            <li><a href="/departments">Departments</a></li>
            <ul class="menu">
                <li><form action="/result" class="search-form">
                    <input type="search" placeholder="Search" id="search" name="search"></li>
                    <li><button type="submit" class="button">Search</button>
                </form></li>
            </ul>
            </ul>
        </div>
        </nav>

        <h1>Departments</h1>
        <!-- This will be the template for each lecture's page, showing all the information we have on that lecture -->
        
    <div>
        <button type="button" class="button" id="pie_chart">Data Sources</button>
    </div>

    <center><div class="container" style="width: 92vw;">
      <div class="grid-container">
        <div class="grid-x grid-padding-x">
          <div class="cell" style="padding: 0; width: 12vw;">
            <div class="button-group stacked-for-small">
              <center>
                  <button class="button stats-selector selected" id="wpm_dept">
                    <p class="selector-text" style="font-size: 1.5vw; padding-top: 2vh;">Avg WPM</p>
                  </button>
                  <button class="button stats-selector" id="vocab_dept">
                    <p class="selector-text" style="font-size: 1.34vw; padding: 1.5vh 0;">Common vocabulary rate<p>
                  </button>
                  <button class="button stats-selector" style="padding: 0;" id="apr_dept">
                    <p class="selector-text" style="font-size: 1vw; padding: 2.5vh 0;"># of audience participations per hour</p>
                  </button>
                  <button class="button stats-selector" id="word_dept">
                    <p class="selector-text" style="font-size: 1.2vw; padding: 3vh 0;"># of words in corpus<p>
                  </button>
                  <button class="button stats-selector">
                    <p class="selector-text" style="font-size: 1.2vw; padding: 2vh 0;"># of lectures in corpus (will add later)</p>
                  </button>
                  <button class="button stats-selector">
                    <p class="selector-text" style="font-size: 1.2vw; padding: 2vh 0;"># of seconds in corpus (will add later)</p>
                  </button>
              </center>
            </div>
          </div>
        </div>
      </div>
      <div>
        <svg style="background-color: rgb(238, 245, 254); height: 65.8vh; border-radius: 20px; border: 1px solid black;"></svg>
      </div>
      <div style="background-color: rgb(249, 222, 173); height: 65.8vh; border-radius: 20px; border: 1px solid black; padding: 10px;">
        <h4>
            <p>Department name</p>
        </h4>
        <table>
            <tr>
                <td>
                    <p>Work in progress</p>
                </td>
                <td>
                    <p>Work in progress</p>
                </td>
            </tr>
        </table>
      </div>
    </div></center>
    <svg></svg>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="static/js/d3test.js"></script>
    <script>
        //okay so this is scuffed but it works, using jinja templating
        //d3 might need to be done in a script tag
        var lectureRaw = '{{ data1 }}';
        //for some reason the unicode or whatever for " is used
        lectureRaw = lectureRaw.replaceAll('&#34;', '\"');
        var lecture = JSON.parse(lectureRaw.replace('&#34;', '\"'))

        var profRaw = '{{ data2 }}';
        profRaw = profRaw.replaceAll('&#34;', '\"');
        var professors = JSON.parse(profRaw.replace('&#34;', '\"'))

        var depRaw = '{{ data3 }}';
        depRaw = depRaw.replaceAll('&#34;', '\"');
        var departments = JSON.parse(depRaw.replace('&#34;', '\"'))

        wpmDeptButton = document.getElementById("wpm_dept");
        vocabDeptButton = document.getElementById("vocab_dept");
        wordDeptButton = document.getElementById("word_dept");
        aprDeptButton = document.getElementById("apr_dept");
        pieChartButton = document.getElementById("pie_chart");


        //g is group in svg, kind of like div in html, removing them wipes the svg "canvas" clean
        var clear = function() {
            d3.selectAll("g").remove();
            d3.selectAll("text").remove();
        }

        //there are some things in this function that should probably be done outside
        //this will create a simple bar graph using department info, since this is easy
        var wpmBar = function() {
            clear();
            //margins for all sides defined here, as well as svg size in case we want bigger or smaller graph
            const left_margin = 75;
            const right_margin = 25;
            const top_margin = 50;
            const bottom_margin = 250;
            const height = 600;
            const width = 800;
            var svg = d3.select("svg")
                .attr("width", width)
                .attr("height", height);

            //may want to define margin for all sides, since bottom margin is much larger than other side margins
            var actualWidth = width-left_margin-right_margin;
            var actualHeight = height-top_margin-bottom_margin;
            //data will be in form of 2 dimensional array
            //sorting for this data can probably be done outside of this function for max efficiency, but too lazy to move this out and rewrite
            var actualData = [];

            //this takes data and populates 2 dimensional array with department name and wpm, sorted by wpm
            dep_keys = Object.keys(departments);
            for (let i = 0; i < dep_keys.length; i++) {
                if (departments[dep_keys[i]][0] != "0") {
                    actualData.push([dep_keys[i], departments[dep_keys[i]][0]]);
                }
            }

            //this part does the sorting
            actualData = actualData.sort( function(a, b) {
                return b[1] - a[1];
            })

            barWidth = Object.keys(actualData).length * 0.5

            var xScale = d3.scaleBand()
                .range([0, actualWidth])
                .padding(0.5);
            var yScale = d3.scaleLinear()
                .range([actualHeight, 0]);

            var g = svg.append("g")
                .attr("transform", "translate(" + left_margin + "," + top_margin + ")");
            
            //this maps the first column of the 2d array into a 1d array
            wpm = actualData.map( function(arr, i) {
                //wpm elements were strings initially
                //* 100 then division by 100 to maintain 2 decimals
                return parseInt(arr[1] * 100) / 100;
            });
            sorted_depts = actualData.map( function(arr, i) {
                return arr[0];
            });
            yScale.domain([70, d3.max(wpm, function(d) {
                return d;
            })]);
            //xscale after y scale because we need sorted wpm list first
            xScale.domain(sorted_depts.map( function(i) {
                return i;
            }));

            //this part is all for translating x axis down and making tick labels readable
            g.append("g")
                .attr("transform", "translate(0," + actualHeight + ")")
                .call(d3.axisBottom(xScale))
                .selectAll("text")
                    .style("text-anchor", "end")
                    .style("font-size", "9px")
                    .attr("dy", "-0.5em")
                    .attr("dx", "-0.6em")
                    .attr("transform", "rotate(-50)");

            //creates a new group for y axis ticks
            g.append("g")
                .call(d3.axisLeft(yScale).tickFormat(function(d) {
                    return d;
                }));

            //hidden divs
            var div = d3.select("body")
                .append("div")
                .attr("class", "hover")
                .style("opacity", 0);

            //creates bars
            g.selectAll("bar")
                .data(wpm)
                .enter() //data takes in array and enter puts it into somewhere?
                .append("rect") //bars are just rectangles
                .attr("class", "bar")
                .on("mouseover", function(d, i) {
                    var xPos = +d3.select(this)
                        .attr("x");
                    var width = +d3.select(this)
                        .attr("width");
                    d3.select(this)
                        .transition()
                        .duration(300)
                        .attr("x", xPos - 5)
                        .attr("width", width + 10)
                        .attr("opacity", 0.8);
                    const [x, y] = d3.pointer(event);
                    div.transition()
                        .duration(100)
                        .style("opacity", 1);
                    div.html("WPM: " + i)
                        .style("left", (x + left_margin) + "px")
                        .style("top", (y + actualHeight - top_margin) + "px");
                })
                .on("mouseout", function() {
                    //mouseout slightly buggy since bars may still be highlighted after cursor goes out of bar
                    d3.select(this)
                        .attr("class", "bar")
                        .transition()
                        .duration(200)
                        .attr("x", function(d) {
                            index = wpm.indexOf(d);
                            return xScale(actualData[index][0]);
                        })
                        .attr("width", xScale.bandwidth())
                        .attr("opacity", 1);
                    div.transition()
                        .duration(100)
                        .style("opacity", 0);
                })
                .attr("x", function(i) {
                    index = wpm.indexOf(i);
                    dept_name_tick = actualData[index][0];
                    return xScale(dept_name_tick)
                })
                .attr("y", function(d) {
                    console.log(d);
                    return yScale(d);
                })
                .attr("width", xScale.bandwidth())
                .attr("height", function(d) {
                    return actualHeight - yScale(d);
                });

            //making title
            svg.append("text") //title is just text
                .style("text-anchor", "middle") //centers text
                .attr("transform", "translate(" + ((actualWidth/2) + left_margin) + "," + "10)") //moves it to relatively central place on top of bar chart
                .attr("y", 20) //move the title down a little
                .attr("font-size", "20px") //bigger font
                .attr("font-weight", 550) //slightly bolder
                .text("Words Per Minute by Department"); //the content
                
            //labeling x-axis, similar to how title is created
            svg.append("text")
                .style("text-anchor", "middle")
                .attr("transform", "translate(" + ((actualWidth/2) + left_margin) + "," + (height - 80) + ")")
                .attr("font-size", "15px")
                .attr("font-weight", 400)
                .text("Department Name");

            //y-axis, pretty much same as x-axis but text is rotated and at middle of height instead of width
            svg.append("text")
                .style("text-anchor", "middle")
                .attr("transform", "translate(20" + "," + ((actualHeight/2) + top_margin) + ")rotate(-90)")
                .attr("font-size", "15px")
                .attr("font-weight", 400)
                .text("WPM");
        }

        //bar graph for vocab
        var vocabBar = function() {
            clear();
            clear();
            //margins for all sides defined here, as well as svg size in case we want bigger or smaller graph
            const left_margin = 75;
            const right_margin = 25;
            const top_margin = 50;
            const bottom_margin = 250;
            const height = 600;
            const width = 800;
            var svg = d3.select("svg")
                .attr("width", width)
                .attr("height", height);

            //may want to define margin for all sides, since bottom margin is much larger than other side margins
            var actualWidth = width-left_margin-right_margin;
            var actualHeight = height-top_margin-bottom_margin;
            //data will be in form of 2 dimensional array
            //sorting for this data can probably be done outside of this function for max efficiency, but too lazy to move this out and rewrite
            var actualData = [];

            //this takes data and populates 2 dimensional array with department name and wpm, sorted by wpm
            dep_keys = Object.keys(departments);
            for (let i = 0; i < dep_keys.length; i++) {
                if (departments[dep_keys[i]][1] != "0") {
                    actualData.push([dep_keys[i], departments[dep_keys[i]][1]]);
                }
            }

            //this part does the sorting
            actualData = actualData.sort( function(a, b) {
                return b[1] - a[1];
            })

            barWidth = Object.keys(actualData).length * 0.5

            var xScale = d3.scaleBand()
                .range([0, actualWidth])
                .padding(0.5);
            var yScale = d3.scaleLinear()
                .range([actualHeight, 0]);

            var g = svg.append("g")
                .attr("transform", "translate(" + left_margin + "," + top_margin + ")");
            
            //this maps the first column of the 2d array into a 1d array
            wpm = actualData.map( function(arr, i) {
                //wpm elements were strings initially
                //* 100 then division by 100 to maintain 3 decimals
                return parseInt(arr[1] * 1000) / 1000;
            });
            sorted_depts = actualData.map( function(arr, i) {
                return arr[0];
            });
            yScale.domain([0.6, d3.max(wpm, function(d) {
                return d;
            })]);
            //xscale after y scale because we need sorted wpm list first
            xScale.domain(sorted_depts.map( function(i) {
                return i;
            }));

            //this part is all for translating x axis down and making tick labels readable
            g.append("g")
                .attr("transform", "translate(0," + actualHeight + ")")
                .call(d3.axisBottom(xScale))
                .selectAll("text")
                    .style("text-anchor", "end")
                    .style("font-size", "9px")
                    .attr("dy", "-0.5em")
                    .attr("dx", "-0.6em")
                    .attr("transform", "rotate(-50)");

            //creates a new group for y axis ticks
            g.append("g")
            .call(d3.axisLeft(yScale).tickFormat(function(d) {
                return d;
            }));

            //hidden divs
            var div = d3.select("body")
                .append("div")
                .attr("class", "hover")
                .style("opacity", 0);

            //creates bars
            g.selectAll("bar")
                .data(wpm)
                .enter() //data takes in array and enter puts it into somewhere?
                .append("rect") //bars are just rectangles
                .attr("class", "bar")
                .on("mouseover", function(d, i) {
                    var xPos = +d3.select(this)
                        .attr("x");
                    var width = +d3.select(this)
                        .attr("width");
                    d3.select(this)
                        .transition()
                        .duration(300)
                        .attr("class", "highlight")
                        .attr("x", xPos - 5)
                        .attr("width", width + 10)
                        .attr("opacity", 0.8);
                    div.transition()
                        .duration(100)
                        .style("opacity", 1);
                    const [x, y] = d3.pointer(event);
                    //console.log(x,y);
                    //console.log(d);
                    div.html("Vocabulary: " + i)
                        .style("left", (x + left_margin) + "px")
                        .style("top", (y + actualHeight - top_margin) + "px");
                })
                .on("mouseout", function() {
                    //mouseout slightly buggy since bars may still be highlighted after cursor goes out of bar
                    d3.select(this)
                        .attr("class", "bar")
                        .transition()
                        .duration(200)
                        .attr("x", function(d) {
                            index = wpm.indexOf(d);
                            return xScale(actualData[index][0]);
                        })
                        .attr("width", xScale.bandwidth())
                        .attr("opacity", 1);
                    div.transition()
                        .duration(100)
                        .style("opacity", 0);
                })
                .attr("x", function(i) {
                    index = wpm.indexOf(i);
                    dept_name_tick = actualData[index][0];
                    return xScale(dept_name_tick)
                })
                .attr("y", function(d) {
                    return yScale(d);
                })
                .attr("width", xScale.bandwidth())
                .attr("height", function(d) {
                    return actualHeight - yScale(d);
                });

            //making title
            svg.append("text") //title is just text
                .style("text-anchor", "middle") //centers text
                .attr("transform", "translate(" + ((actualWidth/2) + left_margin) + "," + "0)") //moves it to relatively central place on top of bar chart
                .attr("y", 30) //move the title down a little
                .attr("font-size", "20px") //bigger font
                .attr("font-weight", 550) //slightly bolder
                .text("Common Vocabulary by Department"); //the content
                
            //labeling x-axis, similar to how title is created
            svg.append("text")
                .style("text-anchor", "middle")
                .attr("transform", "translate(" + ((actualWidth/2) + left_margin) + "," + (height-100) + ")")
                .attr("font-size", "15px")
                .attr("font-weight", 500)
                .text("Department Name");

            //y-axis, pretty much same as x-axis but text is rotated and at middle of height instead of width
            svg.append("text")
                .style("text-anchor", "middle")
                .attr("transform", "translate(10" + "," + ((actualHeight/2) + top_margin) + ")rotate(-90)")
                .attr("font-size", "15px")
                .attr("font-weight", 500)
                .text("Common Vocabulary");
        }

        var aprBar = function() {
            clear();
            //margins for all sides defined here, as well as svg size in case we want bigger or smaller graph
            const left_margin = 75;
            const right_margin = 25;
            const top_margin = 50;
            const bottom_margin = 250;
            const height = 600;
            const width = 800;
            var svg = d3.select("svg")
                .attr("width", width)
                .attr("height", height);

            //may want to define margin for all sides, since bottom margin is much larger than other side margins
            var actualWidth = width-left_margin-right_margin;
            var actualHeight = height-top_margin-bottom_margin;
            //data will be in form of 2 dimensional array
            //sorting for this data can probably be done outside of this function for max efficiency, but too lazy to move this out and rewrite
            var actualData = [];

            //this takes data and populates 2 dimensional array with department name and wpm, sorted by wpm
            dep_keys = Object.keys(departments);
            for (let i = 0; i < dep_keys.length; i++) {
                if (departments[dep_keys[i]][0] != "0") {
                    actualData.push([dep_keys[i], departments[dep_keys[i]][2]]);
                }
            }

            //this part does the sorting
            actualData = actualData.sort( function(a, b) {
                return b[1] - a[1];
            })

            barWidth = Object.keys(actualData).length * 0.5

            var xScale = d3.scaleBand()
                .range([0, actualWidth])
                .padding(0.5);
            var yScale = d3.scaleLinear()
                .range([actualHeight, 0]);

            var g = svg.append("g")
                .attr("transform", "translate(" + left_margin + "," + top_margin + ")");
            
            //this maps the first column of the 2d array into a 1d array
            wpm = actualData.map( function(arr, i) {
                //wpm elements were strings initially
                //* 100 then division by 100 to maintain 2 decimals
                return parseInt(arr[1] * 100) / 100;
            });
            sorted_depts = actualData.map( function(arr, i) {
                return arr[0];
            });
            yScale.domain([0, d3.max(wpm, function(d) {
                return d;
            })]);
            //xscale after y scale because we need sorted wpm list first
            xScale.domain(sorted_depts.map( function(i) {
                return i;
            }));

            //this part is all for translating x axis down and making tick labels readable
            g.append("g")
                .attr("transform", "translate(0," + actualHeight + ")")
                .call(d3.axisBottom(xScale))
                .selectAll("text")
                    .style("text-anchor", "end")
                    .style("font-size", "9px")
                    .attr("dy", "-0.5em")
                    .attr("dx", "-0.6em")
                    .attr("transform", "rotate(-50)");

            //creates a new group for y axis ticks
            g.append("g")
            .call(d3.axisLeft(yScale).tickFormat(function(d) {
                return d;
            }));

            //hidden divs
            var div = d3.select("body")
                .append("div")
                .attr("class", "hover")
                .style("opacity", 0);

            //creates bars
            g.selectAll("bar")
                .data(wpm)
                .enter() //data takes in array and enter puts it into somewhere?
                .append("rect") //bars are just rectangles
                .attr("class", "bar")
                .on("mouseover", function(d, i) {
                    var xPos = +d3.select(this)
                        .attr("x");
                    var width = +d3.select(this)
                        .attr("width");
                    d3.select(this)
                        .transition()
                        .duration(300)
                        .attr("class", "highlight")
                        .attr("x", xPos - 5)
                        .attr("width", width + 10)
                        .attr("opacity", 0.8);
                    const [x, y] = d3.pointer(event);
                    div.transition()
                        .duration(100)
                        .style("opacity", 1);
                    div.html("WPM: " + i)
                        .style("left", (x + left_margin) + "px")
                        .style("top", (y + actualHeight - top_margin) + "px");
                })
                .on("mouseout", function() {
                    //mouseout slightly buggy since bars may still be highlighted after cursor goes out of bar
                    d3.select(this)
                        .attr("class", "bar")
                        .transition()
                        .duration(200)
                        .attr("x", function(d) {
                            index = wpm.indexOf(d);
                            return xScale(actualData[index][0]);
                        })
                        .attr("width", xScale.bandwidth())
                        .attr("opacity", 1);
                    div.transition()
                        .duration(100)
                        .style("opacity", 0);
                })
                .attr("x", function(i) {
                    index = wpm.indexOf(i);
                    dept_name_tick = actualData[index][0];
                    return xScale(dept_name_tick)
                })
                .attr("y", function(d) {
                    return yScale(d);
                })
                .attr("width", xScale.bandwidth())
                .attr("height", function(d) {
                    return actualHeight - yScale(d);
                });

            //making title
            svg.append("text") //title is just text
                .style("text-anchor", "middle") //centers text
                .attr("transform", "translate(" + ((actualWidth/2) + left_margin) + "," + "10)") //moves it to relatively central place on top of bar chart
                .attr("y", 20) //move the title down a little
                .attr("font-size", "20px") //bigger font
                .attr("font-weight", 550) //slightly bolder
                .text("Audience participations per hour by department"); //the content
                
            //labeling x-axis, similar to how title is created
            svg.append("text")
                .style("text-anchor", "middle")
                .attr("transform", "translate(" + ((actualWidth/2) + left_margin) + "," + (height - 80) + ")")
                .attr("font-size", "15px")
                .attr("font-weight", 400)
                .text("Department Name");

            //y-axis, pretty much same as x-axis but text is rotated and at middle of height instead of width
            svg.append("text")
                .style("text-anchor", "middle")
                .attr("transform", "translate(20" + "," + ((actualHeight/2) + top_margin) + ")rotate(-90)")
                .attr("font-size", "15px")
                .attr("font-weight", 400)
                .text("Audience participations/hr");
        }

        var wordsBar = function() {
            clear();
            //margins for all sides defined here, as well as svg size in case we want bigger or smaller graph
            const left_margin = 75;
            const right_margin = 25;
            const top_margin = 50;
            const bottom_margin = 250;
            const height = 600;
            const width = 800;
            var svg = d3.select("svg")
                .attr("width", width)
                .attr("height", height);

            //may want to define margin for all sides, since bottom margin is much larger than other side margins
            var actualWidth = width-left_margin-right_margin;
            var actualHeight = height-top_margin-bottom_margin;
            //data will be in form of 2 dimensional array
            //sorting for this data can probably be done outside of this function for max efficiency, but too lazy to move this out and rewrite
            var actualData = [];

            //this takes data and populates 2 dimensional array with department name and wpm, sorted by wpm
            dep_keys = Object.keys(departments);
            for (let i = 0; i < dep_keys.length; i++) {
                if (departments[dep_keys[i]][0] != "0") {
                    actualData.push([dep_keys[i], departments[dep_keys[i]][3]]);
                }
            }

            //this part does the sorting
            actualData = actualData.sort( function(a, b) {
                return b[1] - a[1];
            })

            barWidth = Object.keys(actualData).length * 0.5

            var xScale = d3.scaleBand()
                .range([0, actualWidth])
                .padding(0.5);
            var yScale = d3.scaleLinear()
                .range([actualHeight, 0]);

            var g = svg.append("g")
                .attr("transform", "translate(" + left_margin + "," + top_margin + ")");
            
            //this maps the first column of the 2d array into a 1d array
            wpm = actualData.map( function(arr, i) {
                //wpm elements were strings initially
                //* 100 then division by 100 to maintain 2 decimals
                return parseInt(arr[1] * 100) / 100;
            });
            sorted_depts = actualData.map( function(arr, i) {
                return arr[0];
            });
            yScale.domain([0, d3.max(wpm, function(d) {
                return d;
            })]);
            //xscale after y scale because we need sorted wpm list first
            xScale.domain(sorted_depts.map( function(i) {
                return i;
            }));

            //this part is all for translating x axis down and making tick labels readable
            g.append("g")
                .attr("transform", "translate(0," + actualHeight + ")")
                .call(d3.axisBottom(xScale))
                .selectAll("text")
                    .style("text-anchor", "end")
                    .style("font-size", "9px")
                    .attr("dy", "-0.5em")
                    .attr("dx", "-0.6em")
                    .attr("transform", "rotate(-50)");

            //creates a new group for y axis ticks
            g.append("g")
            .call(d3.axisLeft(yScale).tickFormat(function(d) {
                return d;
            }));

            //hidden divs
            var div = d3.select("body")
                .append("div")
                .attr("class", "hover")
                .style("opacity", 0);

            //creates bars
            g.selectAll("bar")
                .data(wpm)
                .enter() //data takes in array and enter puts it into somewhere?
                .append("rect") //bars are just rectangles
                .attr("class", "bar")
                .on("mouseover", function(d, i) {
                    var xPos = +d3.select(this)
                        .attr("x");
                    var width = +d3.select(this)
                        .attr("width");
                    d3.select(this)
                        .transition()
                        .duration(300)
                        .attr("class", "highlight")
                        .attr("x", xPos - 5)
                        .attr("width", width + 10)
                        .attr("opacity", 0.8);
                    const [x, y] = d3.pointer(event);
                    div.transition()
                        .duration(100)
                        .style("opacity", 1);
                    div.html("WPM: " + i)
                        .style("left", (x + left_margin) + "px")
                        .style("top", (y + actualHeight - top_margin) + "px");
                })
                .on("mouseout", function() {
                    //mouseout slightly buggy since bars may still be highlighted after cursor goes out of bar
                    d3.select(this)
                        .attr("class", "bar")
                        .transition()
                        .duration(200)
                        .attr("x", function(d) {
                            index = wpm.indexOf(d);
                            return xScale(actualData[index][0]);
                        })
                        .attr("width", xScale.bandwidth())
                        .attr("opacity", 1);
                    div.transition()
                        .duration(100)
                        .style("opacity", 0);
                })
                .attr("x", function(i) {
                    index = wpm.indexOf(i);
                    dept_name_tick = actualData[index][0];
                    return xScale(dept_name_tick)
                })
                .attr("y", function(d) {
                    return yScale(d);
                })
                .attr("width", xScale.bandwidth())
                .attr("height", function(d) {
                    return actualHeight - yScale(d);
                });

            //making title
            svg.append("text") //title is just text
                .style("text-anchor", "middle") //centers text
                .attr("transform", "translate(" + ((actualWidth/2) + left_margin) + "," + "10)") //moves it to relatively central place on top of bar chart
                .attr("y", 20) //move the title down a little
                .attr("font-size", "20px") //bigger font
                .attr("font-weight", 550) //slightly bolder
                .text("# of words in corpus by department"); //the content
                
            //labeling x-axis, similar to how title is created
            svg.append("text")
                .style("text-anchor", "middle")
                .attr("transform", "translate(" + ((actualWidth/2) + left_margin) + "," + (height - 80) + ")")
                .attr("font-size", "15px")
                .attr("font-weight", 400)
                .text("Department Name");

            //y-axis, pretty much same as x-axis but text is rotated and at middle of height instead of width
            svg.append("text")
                .style("text-anchor", "middle")
                .attr("transform", "translate(20" + "," + ((actualHeight/2) + top_margin) + ")rotate(-90)")
                .attr("font-size", "15px")
                .attr("font-weight", 400)
                .text("# of words");
        }

        // this is a pie chart for showing where our sources are from
        // certain departments having missing stats, so this is for the ones that are actually used
        var deptPieChart = function() {
            clear();
            const height = 600; //probably don't need height and width if pie chart svg is a square
            const width = 600;
            const margins = 200;
            const radius = (width - margins) / 2;

            var raw = departments;
            dep_keys = Object.keys(departments);
            var data = [];
            for (let i = 0; i < dep_keys.length; i++) {
                if (departments[dep_keys[i]][3] != "0") {
                    data.push([dep_keys[i], departments[dep_keys[i]][3]]);
                }
            }  

            //javascript sort does not sort numbers by default, treats everything as a string unless specified
            data = data.sort( function(a, b) {
                return b[1] - a[1];
            })

            //may not need this, but it's handy to have a list of all the wpm
            var words = data.map( function(d) {return d[1]});

            //sets attributes for the svg "canvas" and moves it to where it's supposed to be
            var svg = d3.select("svg")
                .attr("width", width)
                .attr("height", height)
            
            g = svg.append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

            //may need an ordinal scale because scale isn't a straight line
            //i copied these colors from a scheme website, there's way too many, also it's a gradient
            var color_scheme = ["#f7fbff","#f6faff","#f5fafe","#f5f9fe","#f4f9fe","#f3f8fe","#f2f8fd","#f2f7fd","#f1f7fd","#f0f6fd","#eff6fc","#eef5fc","#eef5fc","#edf4fc","#ecf4fb","#ebf3fb","#eaf3fb","#eaf2fb","#e9f2fa","#e8f1fa","#e7f1fa","#e7f0fa","#e6f0f9","#e5eff9","#e4eff9","#e3eef9","#e3eef8","#e2edf8","#e1edf8","#e0ecf8","#e0ecf7","#dfebf7","#deebf7","#ddeaf7","#ddeaf6","#dce9f6","#dbe9f6","#dae8f6","#d9e8f5","#d9e7f5","#d8e7f5","#d7e6f5","#d6e6f4","#d6e5f4","#d5e5f4","#d4e4f4","#d3e4f3","#d2e3f3","#d2e3f3","#d1e2f3","#d0e2f2","#cfe1f2","#cee1f2","#cde0f1","#cce0f1","#ccdff1","#cbdff1","#cadef0","#c9def0","#c8ddf0","#c7ddef","#c6dcef","#c5dcef","#c4dbee","#c3dbee","#c2daee","#c1daed","#c0d9ed","#bfd9ec","#bed8ec","#bdd8ec","#bcd7eb","#bbd7eb","#b9d6eb","#b8d5ea","#b7d5ea","#b6d4e9","#b5d4e9","#b4d3e9","#b2d3e8","#b1d2e8","#b0d1e7","#afd1e7","#add0e7","#acd0e6","#abcfe6","#a9cfe5","#a8cee5","#a7cde5","#a5cde4","#a4cce4","#a3cbe3","#a1cbe3","#a0cae3","#9ec9e2","#9dc9e2","#9cc8e1","#9ac7e1","#99c6e1","#97c6e0","#96c5e0","#94c4df","#93c3df","#91c3df","#90c2de","#8ec1de","#8dc0de","#8bc0dd","#8abfdd","#88bedc","#87bddc","#85bcdc","#84bbdb","#82bbdb","#81badb","#7fb9da","#7eb8da","#7cb7d9","#7bb6d9","#79b5d9","#78b5d8","#76b4d8","#75b3d7","#73b2d7","#72b1d7","#70b0d6","#6fafd6","#6daed5","#6caed5","#6badd5","#69acd4","#68abd4","#66aad3","#65a9d3","#63a8d2","#62a7d2","#61a7d1","#5fa6d1","#5ea5d0","#5da4d0","#5ba3d0","#5aa2cf","#59a1cf","#57a0ce","#569fce","#559ecd","#549ecd","#529dcc","#519ccc","#509bcb","#4f9acb","#4d99ca","#4c98ca","#4b97c9","#4a96c9","#4895c8","#4794c8","#4693c7","#4592c7","#4492c6","#4391c6","#4190c5","#408fc4","#3f8ec4","#3e8dc3","#3d8cc3","#3c8bc2","#3b8ac2","#3a89c1","#3988c1","#3787c0","#3686c0","#3585bf","#3484bf","#3383be","#3282bd","#3181bd","#3080bc","#2f7fbc","#2e7ebb","#2d7dbb","#2c7cba","#2b7bb9","#2a7ab9","#2979b8","#2878b8","#2777b7","#2676b6","#2574b6","#2473b5","#2372b4","#2371b4","#2270b3","#216fb3","#206eb2","#1f6db1","#1e6cb0","#1d6bb0","#1c6aaf","#1c69ae","#1b68ae","#1a67ad","#1966ac","#1865ab","#1864aa","#1763aa","#1662a9","#1561a8","#1560a7","#145fa6","#135ea5","#135da4","#125ca4","#115ba3","#115aa2","#1059a1","#1058a0","#0f579f","#0e569e","#0e559d","#0e549c","#0d539a","#0d5299","#0c5198","#0c5097","#0b4f96","#0b4e95","#0b4d93","#0b4c92","#0a4b91","#0a4a90","#0a498e","#0a488d","#09478c","#09468a","#094589","#094487","#094386","#094285","#094183","#084082","#083e80","#083d7f","#083c7d","#083b7c","#083a7a","#083979","#083877","#083776","#083674","#083573","#083471","#083370","#08326e","#08316d","#08306b"];
            var colors_used = [];
            for (let i = 40; i < color_scheme.length; i += 10) {
                colors_used.push(color_scheme[i]);
            }
            var colors = d3.scaleOrdinal(colors_used)
                .domain(words);
            var pie = d3.pie()
                .value( function(d) {
                    return d[1];
                })
            
            //arcs of circle
            var arc = d3.arc()
                .innerRadius(0)
                .outerRadius(radius);
            
            //couldn't make text appear onmouseover, so just make div appear and disappear near cursor
            var div = d3.select("body")
                .append("div")
                .attr("class", "hover")
                .style("opacity", 0);

            var arcs = g.selectAll("arc")
                .data(pie(data))
                .enter()
                .append("g")
                .attr("class", "arc")
                .text("asdf")
                .append("path")
                .attr("d", arc)
                .attr("fill", function(d, i) {
                    return colors(i);
                })
                .attr("transform", "translate(0, 0)")
                .on('mouseover', function(d, i) { //all of this is for hover effects
                    //d is the mouse event, is has a bunch of data (including the data array from above)
                    d3.select(this)
                        .transition()
                        .duration("100")
                        .attr("opacity", "0.8");
                    div.transition() //div will be shown when hovering
                        .duration("50")
                        .style("opacity", 1);
                    //d3's mouse pointer stuff is extremely confusing, but translate the stuff down
                    const [x,y] = d3.pointer(event);
                    //console.log(x, y);
                    div.html(i["data"][0] + ", " + i["data"][1])
                        .style("left", (x + width / 2) + "px")
                        .style("top", (y + height - margins/2) + "px");
                })
                .on("mouseout", function(d, i) {
                    d3.select(this)
                        .transition()
                        .duration("100")
                        .attr("opacity", "1")
                    div.transition()
                        .duration("50")
                        .style("opacity", 0);
                })
            
            //making title
            svg.append("text") //title is just text
                .style("text-anchor", "middle") //centers text
                .attr("transform", "translate(" + (width/2) + "," + "10)") //moves it to relatively central place on top of bar chart
                .attr("y", 20) //move the title down a little
                .attr("font-size", "20px") //bigger font
                .attr("font-weight", 550) //slightly bolder
                .text("Total Number of Words by Department"); //the content
        }

        wpmDeptButton.addEventListener("click", wpmBar);
        vocabDeptButton.addEventListener("click", vocabBar);
        wordDeptButton.addEventListener("click", wordsBar);
        aprDeptButton.addEventListener("click", aprBar);
        pieChartButton.addEventListener("click", deptPieChart);

        wpmBar();

    </script>
</body>
</html>